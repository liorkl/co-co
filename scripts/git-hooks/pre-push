#!/bin/sh
# Git pre-push hook to auto-generate PR description and optionally create PR

branch=$(git branch --show-current)
base_branch="main"

# Check if we're pushing to a feature branch (not main)
if [ "$branch" != "$base_branch" ] && [ "$branch" != "develop" ]; then
  # Check if PR_DESCRIPTION.md exists and is recent (newer than last commit)
  if [ ! -f "PR_DESCRIPTION.md" ] || [ "PR_DESCRIPTION.md" -ot ".git/HEAD" ]; then
    echo ""
    echo "üìù Auto-generating PR description..."
    
    # Run the PR description generator
    if command -v npm >/dev/null 2>&1; then
      npm run pr:description >/dev/null 2>&1
      if [ $? -eq 0 ]; then
        echo "‚úÖ PR description generated in PR_DESCRIPTION.md"
        echo ""
        
        # Note: For fully automated PR creation, use 'npm run push' instead of 'git push'
        # That will push and automatically create PR with the description
      else
        echo "‚ö†Ô∏è  Failed to generate PR description. You can run manually:"
        echo "   npm run pr:description"
        echo ""
      fi
    else
      echo "‚ö†Ô∏è  npm not found. Cannot auto-generate PR description."
      echo "   Run manually: npm run pr:description"
      echo ""
    fi
  fi
fi

exit 0

